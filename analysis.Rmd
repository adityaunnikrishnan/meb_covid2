---
title: "Analysis of MEB COVID Survey 2"
author: "MEB Team"
date: "16 Nov 2021"
output: pdf_document
---

\Large Note: Will explain later

\newpage
\tableofcontents 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(cowplot)
library(tidyverse)
library(ggplot2)
library(MASS)
library(ggrepel)
library(RColorBrewer)
library(stargazer)
library(DeclareDesign)
library(texreg)
library(car)
library(lubridate)
library(scales)
library(cowplot)
library(writexl)
library(janitor)
library(gridExtra)
library(grid)
library(ggpubr)
```

```{r, include=FALSE}
#Import data

#PC import

#raw_dta <- read_csv("C:/Users/Aditya/Google Drive (aditya.unnikrishnan@cprindia.org)/State Capacity/Moral Economy Survey/COVID Short Survey/data_analysis_results/01_raw_data/meb_02102020.csv", col_names = FALSE)

#Mac import

raw_dta <- read_csv("meb2data_23nov.csv.csv", col_names = FALSE)
```

```{r, include=FALSE}
##Shubhangi##
#Clean up: deleting extra columns, merging the state related questions, deleting the old state columns, removing all incomplete answers, adding two filters to ensure only responses by currently serving IAS officers
processed_dta<-raw_dta[-c(1,2),-c(2, 5:9,15,140,141)]%>%
unite('Merged1', X19:X55, remove=FALSE, na.rm=TRUE) %>%
  unite('Merged2', X56:X92, remove = FALSE, na.rm=TRUE) %>%
  unite('Merged3',X93:X129, remove=FALSE, na.rm=TRUE)%>% 
  subset(select=-(X19:X55))%>%
  subset(select=-(X56:X92))%>%
  subset(select=-(X93:X129))%>%
  #na.omit %>%
  filter(!is.na(X139))%>%
  filter(X10=="Yes")
##Shubhangi##
```

```{r, include=FALSE}
##Shubhangi##
#Checking for batch outliers
hist(as.numeric(raw_dta$X11), col="#ccf5ff", border=F, xlab="Year of Joining", ylab = "Frequency", main= "Distribution of IAS Batches")

#None
##Shubhangi##
```

```{r, include=FALSE}
##Shubhangi##
#Checking for respondents who sped through the survey (min time = 3 minutes)
processed_dta$time_spent<-mdy_hms(processed_dta$X4, tz="Asia/Kolkata")- mdy_hms(processed_dta$X3, tz="Asia/Kolkata")
processed_dta<-processed_dta %>%
  mutate(speeders=ifelse(time_spent<3, 1, 0)) 

#Decided not to exclude anyone on this basis
##Shubhangi##
```

```{r, include=FALSE}
##Shubhangi##
#Checking the number of NA responses for each question in the processed data
processed_dta %>% 
  dplyr::select(everything()) %>% 
  summarise_all(funs(sum(is.na(.))))

#Column X136 has 69 NAs, all others have zero.
##Shubhangi##
```

```{r, include=FALSE}
##Shubhangi##
#Separating the states in answers for Merged1 and Merged2

processed_dta<-processed_dta %>% 
 separate(Merged1, c('Merged1.1', 'Merged1.2'), sep = "([_])") %>% 
 separate(Merged2, c('Merged2.1', 'Merged2.2'), sep = "([_])") 
##Shubhangi##
```

```{r, include=FALSE}
#Define new theme 
newtheme <- theme_bw() +
  theme(panel.border = element_rect(color = "darkgrey", size = 2), 
        panel.grid.major = element_blank()
        )
```

```{r, include=FALSE}
##Shubhangi##
set.seed(24102020)

#Creating datasets (1) Currently serving officers allocated to states (2) Currently serving officers by SDG index (3) All respondents by age (former, young and old)

#(1)
#Dataset with only currently serving officers
full_serving <- processed_dta %>% 
  filter(X13=="Yes, currently serving")

#Dataset of currently serving officers allocated to separate states
#Need to check and add the exact distribution of officers in the states and UT for combined cadres
#Question for Aditya: how did the sample function work last time? 
full_allocated <- full_serving %>% 
  mutate(state = ifelse(X12=="Assam Meghalaya", sample(c("Assam", "Meghalaya"), prob = c(1.0, 0.4), size = length(which(full_serving$X12=="Assam Meghalaya")), replace = TRUE),
                        ifelse(X12=="AGMUT", sample(c("Delhi", "Arunachal Pradesh",  "Mizoram","Goa", "DNH and DD","Chandigarh", "Andaman and Nicobar Islands", "Lakshadweep Islands", "Puducherry"), prob = c(1.0,0.5, 0.4, 0.3, 0.2, 0.1, 0.1, 0.1, 0.1), size = length(which(full_serving$X12=="AGMUT")), replace = TRUE), X12)))
 
#(2) 
#Dataset with SDG allocations 
full_sdg<-full_allocated %>% 
  mutate(sdg = ifelse(state== "Uttar Pradesh" | state=="Bihar" | state =="Assam", "Aspirant", 
                      ifelse(state=="Puducherry"|state=="Tamil Nadu"| state=="Chandigarh"| state=="Himachal Pradesh"|state=="Kerala", "Frontrunner", "Performer")))

#Dataset of aspirant states 
fullsdg_aspirant <- full_sdg %>% 
  filter(sdg == "Aspirant") #46 observations 

#Dataset of performer states
fullsdg_performer <- full_sdg %>% 
  filter(sdg == "Performer") #313 observations

#Dataset of frontrunner states
fullsdg_frunner <- full_sdg %>% 
  filter(sdg == "Frontrunner") #65 observations 

#(3) 
#Dataset of former IAS officers
#creating a dataset of former officers and adding a column to indicate the same (this is needed to merge with serving officers) 
fullage_former <- processed_dta %>% 
  filter(X13== "No, I am a former IAS officer") %>% 
  mutate(age = "Former") #92

#Dataset of all respondents with a column that denotes age ("former", young or old)
full_age <- full_serving %>% 
  mutate(age = ifelse(X11>2011, "2012 and after", "2011 and before")) %>% 
  add_row(fullage_former)

#Dataset of young officers
fullage_young <- full_age %>% 
  filter(age == "2012 and after") #231

#Dataset with old officers
fullage_old <- full_age %>% 
  filter(age == "2011 and before") #193
##Shubhangi##
```

<<<<<<< HEAD
```{r, include=FALSE}
##Shubhangi##
#Recoding answer options from characters to numeric values 
#Q7 (X16)
#Q13 (X130)
#Q15 (X132) 
#Leaving Q19 (X136) as is since this is the error question
#Q8 (X17)
#Q9 (X18)
full_serving<-full_serving %>% 
  mutate(X16 = ifelse(X16== "The second Covid-19 surge was expected and should have seen much more advance planning.", 1, 2)) %>% 
  mutate(X130 = ifelse(X130=="Resources and autonomy can always be generated if only the system were to positively acknowledge initiative and motivation as a rule.", 1, 2)) %>% 
  mutate(X132 = ifelse(X132=="Given the lack of consensus in our democracy, any other course of action would have resulted in unnecessary chaos and confusion among the public.", 1, 2)) %>% 
  mutate(X17 = ifelse(X17 =="Even proposals for advance planning received little purchase in the last one year.",1,
                      ifelse(X17 =="Planning got lost mid-way due to signals that we have managed the pandemic well.", 2,
                             ifelse(X17 == "Systematic advance planning has never been part of our ethos.", 3, 4)))) %>%
  mutate(X18 = ifelse(X18 == "Building health system preparedness was not adequately prioritised.",1,
                      ifelse(X18=="Health system preparedness increased but was overwhelmed by the unprecedented scale of the infection.", 2, 
                             ifelse(X18=="Health system preparedness increased substantially and performed adequately.", 3, 4))))
##Shubhangi##
```

```{r}
##Gurkirat##
#Labeling Variables, X133 (Question 16), X134 (Question 17), X135 (Question 18), X137 (Question 20), X138 (Question 21), X139 (Question 22), X136 (Question 19, binary answers)

full_serving <- full_serving %>% 
#Question 16
mutate (X133= ifelse (X133 == "During the pandemic, policy has exhibited a rational response to changing evidence and information about the pandemic.", 1, ifelse(X133 == "Even though the pandemic posed unique challenges, policy making could still be characterised as ad hoc, responding to political imperatives, public pressure and judicial pronouncements.", 2, 3))) %>%

#Question 17
mutate (X134 = ifelse (X134 == "India has successfully followed this nationally laid down trajectory of vaccine implementation.", 1, ifelse(X134 == "Our vaccination efforts have been adequate in following this trajectory though some states could have done better.", 2, ifelse(X134 == "Our vaccination policy implementation has been less than satisfactory because of poor performance at state level.", 3, 4)))) %>% 

#Question 18  
mutate (X135 = ifelse (X135 == "We could at least use our networks to render some assistance at an individual level.", 1, ifelse(X135 == "We should have done so much more to improve the system when we had the time.", 2, ifelse(X135 == "We were as deprived and helpless as the ordinary citizen, in the face of this utter collapse of the health care system.", 3, 4)))) %>%

#Question 20  
mutate (X137 = ifelse (X137 == "The government’s fiscal situation did not permit such measures.", 1, ifelse(X137 == "The pandemic’s limited initial impact led to a view that mass vaccination would not be urgently required in India.", 2, ifelse(X137 == "The private sector in India does not inspire confidence.", 3, 4)))) %>% 

#Question 21  
mutate (X138 = ifelse (X138 == "Slightly agree", 1, ifelse(X138 == "Slightly disagree", 2, ifelse(X138 == "Strongly agree", 3, 4)))) %>% 

#Question 22
mutate (X139 = ifelse (X139 == "By focussing on failures in pandemic management, the media has exaggerated the sense of failure and despair.", 1, ifelse(X133 == "The media has failed to capture the full scale and intensity of the disaster.", 2, 3))) %>% 

#Question 19 (not certain)
mutate (X136 = ifelse (X136 == "The government must acknowledge its failure.", 1, 2))

##Gurkirat##
```
















