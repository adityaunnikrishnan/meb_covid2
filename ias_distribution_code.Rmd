---
title: "ias_distribution_code"

```{r setup, include=FALSE}
#reading in libraries + dataset -- also adding the TCPD dataset to our git so that we can all run this code from the same working directory 
library(tidyverse)
library(xlsx)
raw_dta<-read.csv("ias-profile.csv")
```


```{r setup, include=FALSE}
#Creating a dataset where each row is a different cadre and each column in the allocation year. Additional columns indicating total number of officers, number of officers pre and post 2012, and their respective proportions are given. 
#The last row are the total values 
processed_dta<-raw_dta %>% 
  filter(Retired=="TRUE") %>% 
  dplyr::select(c(Cadre, Allotment_Year)) %>% 
  group_by(Cadre) %>% 
  summarise(X1982=sum(Allotment_Year=="1982"),
            X1983=sum(Allotment_Year=="1983"),
            X1984=sum(Allotment_Year=="1984"),
            X1985=sum(Allotment_Year=="1985"),
            X1986=sum(Allotment_Year=="1986"),
            X1987=sum(Allotment_Year=="1987"),
            X1988=sum(Allotment_Year=="1988"),
            X1989=sum(Allotment_Year=="1989"),
            X1990=sum(Allotment_Year=="1990"),
            X1991=sum(Allotment_Year=="1991"),
            X1992=sum(Allotment_Year=="1992"),
            X1993=sum(Allotment_Year=="1993"),
            X1994=sum(Allotment_Year=="1994"),
            X1995=sum(Allotment_Year=="1995"),
            X1996=sum(Allotment_Year=="1996"),
            X1997=sum(Allotment_Year=="1997"),
            X1998=sum(Allotment_Year=="1998"),
            X1999=sum(Allotment_Year=="1999"),
            X2000=sum(Allotment_Year=="2000"),
            X2001=sum(Allotment_Year=="2001"),
            X2002=sum(Allotment_Year=="2002"),
            X2003=sum(Allotment_Year=="2003"),
            X2004=sum(Allotment_Year=="2004"),
            X2005=sum(Allotment_Year=="2005"),
            X2006=sum(Allotment_Year=="2006"),
            X2007=sum(Allotment_Year=="2007"),
            X2008=sum(Allotment_Year=="2008"),
            X2009=sum(Allotment_Year=="2009"),
            X2010=sum(Allotment_Year=="2010"),
            X2011=sum(Allotment_Year=="2011"),
            X2012=sum(Allotment_Year=="2012"),
            X2013=sum(Allotment_Year=="2013"),
            X2014=sum(Allotment_Year=="2014"),
            X2015=sum(Allotment_Year=="2015"),
            X2016=sum(Allotment_Year=="2016"),
            X2017=sum(Allotment_Year=="2017"),
            X2018=sum(Allotment_Year=="2018"),
            X2019=sum(Allotment_Year=="2019"),
            X2020=sum(Allotment_Year=="2020")) %>% 
  ungroup() %>% 
  mutate(pre2012=rowSums(.[2:31])) %>% #1982 to 2011
  mutate(post2012=rowSums(.[32:40])) %>% 
  mutate(total= rowSums(.[41:42])) %>% 
  bind_rows(summarise_all(.,~if(is.numeric(.)) sum(.) else("Total"))) %>% #Help: I don't know why this red cross is showing up, because the code runs exactly like I want it to and without errors
   mutate(prop_pre2012 = pre2012/total) %>% 
  mutate(prop_post2012 = post2012/total)  
```

```{r setup, include=FALSE}
#Writing the excel file 
write.xlsx(processed_dta, file="~/meb_covid2/IAS Cadre_Year Distribution_TCPD1.1.2021.xlsx", sheetName="Sheet 1", col.names=TRUE, row.names=TRUE, append=FALSE) #I don't think this file path saves it on git. But I have added the excel file separately. Will correct this later. 
```

